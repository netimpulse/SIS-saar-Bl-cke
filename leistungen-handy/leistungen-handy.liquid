{% comment %}
  Section: Leistungen Handy
  – Slider/Carousel
  – Mobile optimiert (Touch-Scroll, 1 Leistung pro View)
{% endcomment %}

{{ 'leistungen-handy.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}.leistungen-handy-section {
    background-color: {{ section.settings.section_bg_color }};
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }

  .section-{{ section.id }} .leistungen-handy-wrapper {
    transform: scale({{ section.settings.section_scale | divided_by: 100.0 }});
    transform-origin: top center;
  }

  .section-{{ section.id }} .carousel-slide {
    padding: 0 {{ section.settings.item_spacing | divided_by: 2.0 }}px;
  }

  .section-{{ section.id }} .leistungen-handy-heading {
    color: {{ section.settings.heading_color }};
    font-size: {{ section.settings.heading_font_size }}px;
    font-family: {{ section.settings.heading_font.family }}, {{ section.settings.heading_font.fallback_families }};
    font-weight: {% if section.settings.heading_bold %}bold{% else %}normal{% endif %};
    font-style: {% if section.settings.heading_italic %}italic{% else %}normal{% endif %};
  }

  .section-{{ section.id }} .carousel-arrow { color: {{ section.settings.arrow_color }}; }
  .section-{{ section.id }} .service-item__timeline-connector { background-color: {{ section.settings.line_color }}; }

  /* Block-spezifische Typo und Bildrahmen */
  {% for block in section.blocks %}
    .section-{{ section.id }} .service-item-{{ block.id }} .service-item__image-wrapper {
      --image-diameter: {{ block.settings.image_diameter }}px;
      border: {{ block.settings.image_border_width }}px solid {{ block.settings.image_border_color }};
    }
    .section-{{ section.id }} .service-item-{{ block.id }} .service-item__title {
      font-size: {{ block.settings.title_font_size }}px;
      color: {{ block.settings.title_color }};
      font-family: {{ block.settings.title_font.family }}, {{ block.settings.title_font.fallback_families }};
      font-weight: {% if block.settings.title_bold %}bold{% else %}normal{% endif %};
      font-style: {% if block.settings.title_italic %}italic{% else %}normal{% endif %};
    }
    .section-{{ section.id }} .service-item-{{ block.id }} .service-item__subtitle {
      font-size: {{ block.settings.subtitle_font_size }}px;
      color: {{ block.settings.subtitle_color }};
      font-family: {{ block.settings.subtitle_font.family }}, {{ block.settings.subtitle_font.fallback_families }};
      font-weight: {% if block.settings.subtitle_bold %}bold{% else %}normal{% endif %};
      font-style: {% if block.settings.subtitle_italic %}italic{% else %}normal{% endif %};
    }
    .section-{{ section.id }} .service-item-{{ block.id }} .service-item__text,
    .section-{{ section.id }} .service-item-{{ block.id }} .service-item__text p {
      font-size: {{ block.settings.text_font_size }}px;
      color: {{ block.settings.text_color }};
      font-family: {{ block.settings.text_font.family }}, {{ block.settings.text_font.fallback_families }};
      font-weight: {% if block.settings.text_bold %}bold{% else %}normal{% endif %};
      font-style: {% if block.settings.text_italic %}italic{% else %}normal{% endif %};
    }
  {% endfor %}

  /* CTA Farbanpassungen & Ausrichtung */
  .section-{{ section.id }} .leistungen-handy-cta {
    text-align:
      {% case section.settings.cta_align %}
        {% when 'left' %} left
        {% when 'right' %} right
        {% else %} center
      {% endcase %};
  }
  .section-{{ section.id }} .leistungen-handy-cta__kicker {
    color: {{ section.settings.cta_kicker_color }};
  }
  .section-{{ section.id }} .leistungen-handy-cta__btn {
    color: {{ section.settings.cta_btn_text_color }};
    background: {% if section.settings.cta_btn_style == 'primary' %} {{ section.settings.cta_btn_bg_color }} {% else %} transparent {% endif %};
    border-color: {% if section.settings.cta_btn_style == 'primary' %} {{ section.settings.cta_btn_bg_color }} {% else %} {{ section.settings.cta_btn_text_color }} {% endif %};
  }
{%- endstyle -%}

<div class="section-{{ section.id }} leistungen-handy-section" data-section-id="{{ section.id }}">
  <div class="leistungen-handy-wrapper">
    <div class="leistungen-handy-container">

      {%- if section.settings.heading != blank -%}
        <h2 class="leistungen-handy-heading">{{ section.settings.heading | escape }}</h2>
      {%- endif -%}

      <div class="carousel-wrapper">
        <div class="carousel-viewport">
          <div class="carousel-track">
            {%- for block in section.blocks -%}
              {%- render 'service-item-leistungen-handy', block: block, section: section -%}
            {%- endfor -%}
          </div>
          <div class="service-item__timeline-connector"></div>
        </div>

        {%- if section.blocks.size > 1 -%}
          <button type="button" class="carousel-arrow carousel-arrow--prev" aria-label="Vorherige Leistung">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
          </button>
          <button type="button" class="carousel-arrow carousel-arrow--next" aria-label="Nächste Leistung">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
          </button>
        {%- endif -%}
      </div>

      {%- if section.settings.cta_kicker != blank or section.settings.cta_btn_label != blank -%}
        <div class="leistungen-handy-cta">
          {%- if section.settings.cta_kicker != blank -%}
            <p class="leistungen-handy-cta__kicker">{{ section.settings.cta_kicker | escape }}</p>
          {%- endif -%}
          {%- if section.settings.cta_btn_label != blank -%}
            <a class="leistungen-handy-cta__btn"
               href="{{ section.settings.cta_btn_link | default: '/' }}"
               {% if section.settings.cta_btn_newtab %} target="_blank" rel="noopener noreferrer" {% endif %}>
              {{ section.settings.cta_btn_label | escape }}
            </a>
          {%- endif -%}
        </div>
      {%- endif -%}

    </div>
  </div>
</div>

{{ 'leistungen-handy.js' | asset_url | script_tag }}

{% schema %}
{
  "name": "Leistungen Handy",
  "tag": "section",
  "class": "leistungen-handy-section-wrapper",
  "max_blocks": 15,
  "settings": [
    { "type": "header", "content": "Allgemein" },
    { "type": "text", "id": "heading", "label": "Überschrift", "default": "Unsere Leistungen" },
    { "type": "font_picker", "id": "heading_font", "label": "Schriftart der Überschrift", "default": "sans-serif" },
    { "type": "checkbox", "id": "heading_bold", "label": "Fett", "default": true },
    { "type": "checkbox", "id": "heading_italic", "label": "Kursiv", "default": false },
    { "type": "range", "id": "heading_font_size", "min": 20, "max": 80, "step": 1, "unit": "px", "label": "Schriftgröße der Überschrift", "default": 42 },
    { "type": "color", "id": "heading_color", "label": "Farbe der Überschrift", "default": "#333333" },

    { "type": "header", "content": "Abstände & Größe" },
    { "type": "range", "id": "section_scale", "min": 50, "max": 100, "step": 5, "unit": "%", "label": "Gesamte Größe (Skalierung)", "default": 100 },
    { "type": "range", "id": "item_spacing", "min": 0, "max": 80, "step": 2, "unit": "px", "label": "Abstand zwischen den Elementen", "default": 30 },
    { "type": "range", "id": "padding_top", "min": 0, "max": 200, "step": 5, "unit": "px", "label": "Innenabstand Oben", "default": 50 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 200, "step": 5, "unit": "px", "label": "Innenabstand Unten", "default": 50 },
    { "type": "color", "id": "section_bg_color", "label": "Hintergrundfarbe", "default": "#FFFFFF" },
    { "type": "color", "id": "arrow_color", "label": "Pfeilfarbe", "default": "#111111" },
    { "type": "color", "id": "line_color", "label": "Farbe der Verbindungslinie", "default": "#DDDDDD" },

    { "type": "header", "content": "CTA unter dem Slider" },
    { "type": "text", "id": "cta_kicker", "label": "Kleiner Überschriftssatz (optional)", "default": "Mehr zu unseren Services" },
    { "type": "text", "id": "cta_btn_label", "label": "Button-Text", "default": "Alle Leistungen ansehen" },
    { "type": "url", "id": "cta_btn_link", "label": "Ziel-Link" },
    { "type": "checkbox", "id": "cta_btn_newtab", "label": "In neuem Tab öffnen", "default": false },
    { "type": "select", "id": "cta_btn_style", "label": "Button-Stil", "default": "primary",
      "options": [
        { "value": "primary", "label": "Gefüllt (Primary)" },
        { "value": "outline", "label": "Outline" }
      ]
    },
    { "type": "select", "id": "cta_align", "label": "Ausrichtung", "default": "center",
      "options": [
        { "value": "left", "label": "Links" },
        { "value": "center", "label": "Zentriert" },
        { "value": "right", "label": "Rechts" }
      ]
    },
    { "type": "color", "id": "cta_kicker_color", "label": "Kicker-Farbe", "default": "#555555" },
    { "type": "color", "id": "cta_btn_bg_color", "label": "Button-Hintergrund (Primary)", "default": "#111111" },
    { "type": "color", "id": "cta_btn_text_color", "label": "Button-Textfarbe", "default": "#FFFFFF" }
  ],
  "blocks": [
    {
      "type": "service_block",
      "name": "Leistung",
      "settings": [
        { "type": "header", "content": "Bilder & Rand" },
        { "type": "image_picker", "id": "main_image", "label": "Hauptbild (rund)" },
        { "type": "image_picker", "id": "number_icon", "label": "Icon-Bild (z. B. Nummer)" },
        { "type": "range", "id": "image_diameter", "min": 80, "max": 200, "step": 5, "unit": "px", "label": "Größe des Hauptbildes", "default": 150 },
        { "type": "color", "id": "image_border_color", "label": "Randfarbe des Bildes", "default": "#E0E0E0" },
        { "type": "range", "id": "image_border_width", "min": 0, "max": 15, "step": 1, "unit": "px", "label": "Randbreite des Bildes", "default": 4 },

        { "type": "header", "content": "Texte" },
        { "type": "text", "id": "title", "label": "Titel", "default": "Industrieservice" },
        { "type": "text", "id": "subtitle", "label": "Untertitel", "default": "Gebäudeservice" },
        { "type": "richtext", "id": "text", "label": "Beschreibungstext", "default": "<p>Listenpunkt 1<br>Listenpunkt 2</p>" },

        { "type": "header", "content": "Text-Styling: Titel" },
        { "type": "font_picker", "id": "title_font", "label": "Schriftart", "default": "sans-serif" },
        { "type": "checkbox", "id": "title_bold", "label": "Fett", "default": true },
        { "type": "checkbox", "id": "title_italic", "label": "Kursiv", "default": false },
        { "type": "range", "id": "title_font_size", "min": 12, "max": 40, "step": 1, "unit": "px", "label": "Schriftgröße", "default": 20 },
        { "type": "color", "id": "title_color", "label": "Farbe", "default": "#000000" },

        { "type": "header", "content": "Text-Styling: Untertitel" },
        { "type": "font_picker", "id": "subtitle_font", "label": "Schriftart", "default": "sans-serif" },
        { "type": "checkbox", "id": "subtitle_bold", "label": "Fett", "default": false },
        { "type": "checkbox", "id": "subtitle_italic", "label": "Kursiv", "default": false },
        { "type": "range", "id": "subtitle_font_size", "min": 10, "max": 30, "step": 1, "unit": "px", "label": "Schriftgröße", "default": 16 },
        { "type": "color", "id": "subtitle_color", "label": "Farbe", "default": "#555555" },

        { "type": "header", "content": "Text-Styling: Beschreibung" },
        { "type": "font_picker", "id": "text_font", "label": "Schriftart", "default": "sans-serif" },
        { "type": "checkbox", "id": "text_bold", "label": "Fett", "default": false },
        { "type": "checkbox", "id": "text_italic", "label": "Kursiv", "default": false },
        { "type": "range", "id": "text_font_size", "min": 10, "max": 24, "step": 1, "unit": "px", "label": "Schriftgröße", "default": 14 },
        { "type": "color", "id": "text_color", "label": "Farbe", "default": "#333333" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Leistungen Handy",
      "blocks": [
        { "type": "service_block" },
        { "type": "service_block" },
        { "type": "service_block" },
        { "type": "service_block" }
      ]
    }
  ]
}
{% endschema %}
