{% comment %}
  Über Uns (Layout) – v3.1
  - Bild-Position:
      • left / right  → Bild floatet, Text umfließt
      • top / bottom  → Gestapelt (volle Breite)
  - Vertikale Ausrichtung bei left/right = Einfügeposition im Text:
      • start  → Bild direkt am Anfang des Textes
      • center → Bild nach ca. der Hälfte der Absätze
      • end    → Bild vor dem letzten Absatz
  - Kein Bild → Textausrichtung wählbar
{% endcomment %}

{{ 'section-ueber-uns-layout-v3.css' | asset_url | stylesheet_tag }}

<style>
  #shopify-section-{{ section.id }} {
    --background-color: {{ section.settings.background_color }};
    --section-padding-top: {{ section.settings.section_padding_top }}px;
    --section-padding-bottom: {{ section.settings.section_padding_bottom }}px;

    --title-color: {{ section.settings.title_color }};
    --title-font-size: {{ section.settings.title_font_size }}px;

    --subtitle-color: {{ section.settings.subtitle_color }};
    --subtitle-font-size: {{ section.settings.subtitle_font_size }}px;

    --text-color: {{ section.settings.text_color }};
    --text-font-size: {{ section.settings.text_font_size }}px;

    --image-border-radius: {{ section.settings.image_border_radius }}px;
    --image-max-width: {{ section.settings.image_max_width }}%;
    --image-aspect-ratio: {{ section.settings.image_aspect_ratio }};

    --features-per-row: {{ section.settings.features_per_row }};
    --icon-size: {{ section.settings.icon_size }}px;
    --icon-color: {{ section.settings.icon_color }};
    --feature-title-color: {{ section.settings.feature_title_color }};

    --no-image-text-align: {{ section.settings.no_image_text_align }};
  }
</style>

{%- liquid
  assign img_pos = section.settings.image_position
  assign show_image = section.settings.show_image
  assign has_image = false
  if section.settings.image != blank
    assign has_image = true
  endif
  assign actually_show_image = false
  if show_image and has_image
    assign actually_show_image = true
  endif

  assign title_html = section.settings.title_richtext
  if title_html == blank and section.settings.title != blank
    assign title_html = '<p>' | append: section.settings.title | append: '</p>'
  endif

  assign subtitle_html = section.settings.subtitle_richtext
  if subtitle_html == blank and section.settings.subtitle != blank
    assign subtitle_html = '<p>' | append: section.settings.subtitle | append: '</p>'
  endif

  assign float_mode = false
  if img_pos == 'left' or img_pos == 'right'
    assign float_mode = true
  endif
-%}

<div class="sis-about-section">
  <div class="sis-about__container">

    <div class="
      sis-about__grid
      {% if float_mode %} sis-about__grid--float{% endif %}
      {% if img_pos == 'top' %} sis-about__grid--stack sis-about__grid--image-first{% endif %}
      {% if img_pos == 'bottom' %} sis-about__grid--stack sis-about__grid--image-last{% endif %}
      {% unless actually_show_image %} sis-about__grid--no-image{% endunless %}
    ">

      {%- if actually_show_image -%}
        {%- unless float_mode -%}
          <div class="sis-about__image sis-about__image--valign-{{ section.settings.image_vertical_align }}">
            <div class="sis-about__image-wrapper">
              {% assign img = section.settings.image %}
              <img
                src="{{ img | image_url: width: 1200 }}"
                srcset="{{ img | image_url: width: 600 }} 600w, {{ img | image_url: width: 900 }} 900w, {{ img | image_url: width: 1200 }} 1200w"
                sizes="(max-width: 992px) 100vw, 50vw"
                alt="{{ section.settings.image_alt | escape }}"
                loading="lazy">
            </div>
          </div>
        {%- endunless -%}
      {%- endif -%}

      <div class="sis-about__content">
        {% if title_html != blank %}
          <div class="sis-about__title rte--title">{{ title_html }}</div>
        {% endif %}

        {% if subtitle_html != blank %}
          <div class="sis-about__subtitle rte--subtitle">{{ subtitle_html }}</div>
        {% endif %}

        {%- comment -%}
          Beschreibung + ggf. Float-Bild an der richtigen Position einfügen
        {%- endcomment -%}
        <div class="sis-about__description">
          {%- assign desc_html = section.settings.description -%}

          {%- if actually_show_image and float_mode -%}
            {%- capture float_markup -%}
              <div class="sis-about__image sis-about__image--float {% if img_pos == 'left' %}sis-about__image--float-left{% else %}sis-about__image--float-right{% endif %}">
                <div class="sis-about__image-wrapper">
                  {% assign img = section.settings.image %}
                  <img
                    src="{{ img | image_url: width: 1200 }}"
                    srcset="{{ img | image_url: width: 600 }} 600w, {{ img | image_url: width: 900 }} 900w, {{ img | image_url: width: 1200 }} 1200w"
                    sizes="(max-width: 992px) 100vw, 50vw"
                    alt="{{ section.settings.image_alt | escape }}"
                    loading="lazy">
                </div>
              </div>
            {%- endcapture -%}

            {%- if section.settings.image_vertical_align == 'start' -%}
              {{ float_markup }}
              {{ desc_html }}

            {%- else -%}
              {%- assign parts = desc_html | split: '</p>' -%}
              {%- assign total = parts | size -%}
              {%- if section.settings.image_vertical_align == 'end' -%}
                {%- assign insert_after = total | minus: 2 -%}
              {%- else -%}
                {%- assign insert_after = total | divided_by: 2 -%}
              {%- endif -%}

              {%- for part in parts -%}
                {%- unless part == '' -%}
                  {{ part }}</p>
                  {%- if forloop.index == insert_after -%}
                    {{ float_markup }}
                  {%- endif -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endif -%}

          {%- else -%}
            {{ desc_html }}
          {%- endif -%}
        </div>

        {% if section.blocks.size > 0 %}
          <div class="sis-about__features">
            {% for block in section.blocks %}
              <div class="sis-about__feature" {{ block.shopify_attributes }}>
                <div class="sis-about__feature-icon">
                  {% if block.settings.icon_type == 'image' and block.settings.icon_image != blank %}
                    <img
                      src="{{ block.settings.icon_image | image_url: width: 160, height: 160 }}"
                      alt="{{ block.settings.feature_title | escape }}"
                      width="{{ section.settings.icon_size }}"
                      height="{{ section.settings.icon_size }}"
                      style="width:{{ section.settings.icon_size }}px;height:auto"
                      loading="lazy">
                  {% elsif block.settings.icon_type == 'svg' and block.settings.icon_svg != blank %}
                    {{ block.settings.icon_svg }}
                  {% endif %}
                </div>
                <div class="sis-about__feature-text">
                  <h4 class="sis-about__feature-title">{{ block.settings.feature_title }}</h4>
                  <p class="sis-about__feature-description">{{ block.settings.feature_description }}</p>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>

    </div>
  </div>
</div>

{% schema %}
{
  "name": "Über Uns (Layout) – v3",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "select",
      "id": "image_position",
      "label": "Bild-Position",
      "options": [
        { "value": "right", "label": "Text links, Bild rechts (Text umfließt Bild)" },
        { "value": "left",  "label": "Bild links, Text rechts (Text umfließt Bild)" },
        { "value": "top",   "label": "Bild oben (volle Breite)" },
        { "value": "bottom","label": "Bild unten (volle Breite)" }
      ],
      "default": "right"
    },
    {
      "type": "select",
      "id": "image_vertical_align",
      "label": "Ausrichtung bei links/rechts (Einfügeposition im Text)",
      "options": [
        { "value": "start",  "label": "Oben (direkt am Anfang)" },
        { "value": "center", "label": "Mittig (nach ca. der Hälfte)" },
        { "value": "end",    "label": "Unten (vor letztem Absatz)" }
      ],
      "default": "center"
    },

    { "type": "checkbox", "id": "show_image", "label": "Bild anzeigen", "default": true },

    { "type": "color", "id": "background_color", "label": "Hintergrundfarbe", "default": "#FFFFFF" },
    { "type": "range", "id": "section_padding_top", "label": "Abstand oben", "min": 0, "max": 150, "step": 5, "unit": "px", "default": 80 },
    { "type": "range", "id": "section_padding_bottom", "label": "Abstand unten", "min": 0, "max": 150, "step": 5, "unit": "px", "default": 80 },

    { "type": "text", "id": "title", "label": "Titel (Fallback)", "default": "Über uns" },
    { "type": "richtext", "id": "title_richtext", "label": "Titel (Richtext)", "default": "<p><strong>Über uns</strong></p>" },
    { "type": "color", "id": "title_color", "label": "Titel Farbe", "default": "#111827" },
    { "type": "range", "id": "title_font_size", "label": "Titel Schriftgröße", "min": 20, "max": 56, "step": 2, "unit": "px", "default": 32 },

    { "type": "text", "id": "subtitle", "label": "Untertitel (Fallback)", "default": "Unsere Mission" },
    { "type": "richtext", "id": "subtitle_richtext", "label": "Untertitel (Richtext)", "default": "<p>Unsere Mission</p>" },
    { "type": "color", "id": "subtitle_color", "label": "Untertitel Farbe", "default": "#374151" },
    { "type": "range", "id": "subtitle_font_size", "label": "Untertitel Schriftgröße", "min": 16, "max": 32, "step": 1, "unit": "px", "default": 20 },

    { "type": "richtext", "id": "description", "label": "Beschreibungstext", "default": "<p>Wir sind SIS Saar – ein innovatives Unternehmen …</p>" },
    { "type": "color", "id": "text_color", "label": "Text Farbe", "default": "#6B7280" },
    { "type": "range", "id": "text_font_size", "label": "Text Schriftgröße", "min": 14, "max": 22, "step": 1, "unit": "px", "default": 18 },

    { "type": "image_picker", "id": "image", "label": "Bild" },
    { "type": "range", "id": "image_border_radius", "label": "Bild Eckenrundung", "min": 0, "max": 40, "step": 2, "unit": "px", "default": 12 },
    { "type": "text", "id": "image_alt", "label": "Bild Alt-Text" },
    { "type": "range", "id": "image_max_width", "label": "Bild max. Breite", "min": 40, "max": 100, "step": 5, "unit": "%", "default": 85 },
    {
      "type": "select",
      "id": "image_aspect_ratio",
      "label": "Bild Seitenverhältnis",
      "options": [
        { "value": "auto", "label": "Automatisch" },
        { "value": "16/9", "label": "16:9 (breit)" },
        { "value": "4/3", "label": "4:3" },
        { "value": "1/1", "label": "1:1 (quadratisch)" }
      ],
      "default": "4/3"
    },

    {
      "type": "select",
      "id": "features_per_row",
      "label": "Elemente pro Zeile",
      "options": [ { "value": "1", "label": "1" }, { "value": "2", "label": "2" } ],
      "default": "2"
    },
    { "type": "range", "id": "icon_size", "label": "Icon Größe", "min": 24, "max": 48, "step": 2, "unit": "px", "default": 32 },
    { "type": "color", "id": "icon_color", "label": "SVG-Icon Farbe", "default": "#34D399" },
    { "type": "color", "id": "feature_title_color", "label": "Feature Titel Farbe", "default": "#111827" },

    {
      "type": "select",
      "id": "no_image_text_align",
      "label": "Textausrichtung (kein Bild)",
      "options": [
        { "value": "left", "label": "Links" },
        { "value": "center", "label": "Zentriert" },
        { "value": "right", "label": "Rechts" }
      ],
      "default": "left"
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature Punkt",
      "settings": [
        { "type": "select", "id": "icon_type", "label": "Icon-Typ", "options": [ { "value": "svg", "label": "SVG" }, { "value": "image", "label": "Bild" } ], "default": "svg" },
        { "type": "html", "id": "icon_svg", "label": "SVG Code" },
        { "type": "image_picker", "id": "icon_image", "label": "Icon-Bild" },
        { "type": "text", "id": "feature_title", "label": "Titel", "default": "Feature Titel" },
        { "type": "text", "id": "feature_description", "label": "Beschreibung", "default": "Kurze Beschreibung" }
      ]
    }
  ],
  "presets": [
    { "name": "Über Uns (Layout) – v3", "blocks": [ { "type": "feature" }, { "type": "feature" } ] }
  ]
}
{% endschema %}
